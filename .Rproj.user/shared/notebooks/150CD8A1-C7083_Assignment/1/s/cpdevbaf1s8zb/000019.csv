"0",""
"0","  amounts <- dat %>% "
"0","    # Create ordered factors for food category by median consumption"
"0","    mutate(food_category = fct_reorder(food_category, consumption, .fun='median')) "
"0","  "
"0","  "
"0","  ggplot(amounts, aes(x = food_category, y = consumption))+"
"0","    # Add the raincloud part of plot"
"0","    ggdist::stat_halfeye( fill = cbbPalette[8],"
"0","                          adjust = 0.5, "
"0","                          width = .6, "
"0","                          .width = 0, "
"0","                          justification = -.2, "
"0","                          point_colour = NA,"
"0","                          normalize = 'groups', "
"0","    )+# add boxplot to show distribution"
"0","    geom_boxplot( width = 0.15,"
"0","                  outlier.colour = NA,"
"0","                  alpha = 0.5)+"
"0","    # add 'rain' "
"0","    stat_dots(alpha = 1,"
"0","              fill = cbbPalette[1],"
"0","              dotsize = 1,"
"0","              side = 'left')+"
"0","    # flip so that rain falls down"
"0","    coord_flip()+"
"0","    theme_minimal(base_size = 15)+"
"0","    labs(title = 'Consumption of food categories by country',"
"0","         subtitle = ""<span style='color:#D55E00'>Maximum amount (KG)</span>"","
"0","         x = NULL,"
"0","         y = ' Consumption per capita (KG)') +"
"0","    theme(legend.position = 'none', # remove legend"
"0","          plot.title = element_text(),"
"0","          plot.subtitle = element_markdown(hjust =.4), # set as markdown to allow colour change"
"0","          axis.text.y = element_text(vjust = -1),"
"0","          panel.grid.major.y = element_blank(), # remove grid lines"
"0","          panel.grid.minor.x = element_blank())+ "
"0","    scale_y_continuous(breaks = seq(0, 450, by = 50))+ # set y axis breaks"
"0","    # add label and arrow for Highest value: Finland"
"0","    geom_curve(aes(x = 7.5, y = 355, xend = 9.8, yend = 421), "
"0","               colour = cbbPalette[1], "
"0","               size=1,"
"0","               curvature = 0.4,"
"0","               arrow = arrow(length = unit(0.03, ""npc"")))+"
"0","    geom_label(aes(x = 8, y = 400,"
"0","                   label = 'Finland consumes\n"
"0","                 the most dairy\n"
"0","                 products per capita'),"
"0","               hjust = 1,"
"0","               vjust = 1,"
"0","               lineheight = 0.8,"
"0","               label.size = NA,"
"0","               colour = cbbPalette[7]) +"
"0","    # label all the highest figures by category"
"0","    geom_label_repel(data = amounts %>%"
"0","                       group_by(food_category) %>%"
"0","                       summarise(max = max(consumption)),"
"0","                     aes(x = food_category, y = max,"
"0","                         label = max),"
"0","                     colour = cbbPalette[7], label.size = NA,"
"0","                     min.segment.length = 0)"
